{"version":3,"file":"index.modern.js","sources":["../src/index.js"],"sourcesContent":["import React, { useRef, useEffect, createContext, useContext, useState, Fragment } from 'react'\nimport shortid from 'shortid'\nimport makeDebug from 'debug'\n\nexport const SimpleFileUploadContext = createContext({\n  apiKey: '',\n  width: 160,\n  height: 160\n})\n\nexport const useSimpleFileUpload = () => useContext(SimpleFileUploadContext)\n\nexport const SimpleFileUploadProvider = ({\n  apiKey,\n  width,\n  height,\n  children\n}) => {\n  const value = {\n    apiKey,\n    width: +width,\n    height: +height\n  }\n\n  return (\n    <SimpleFileUploadContext.Provider value={value}>\n      {children}\n    </SimpleFileUploadContext.Provider>\n  )\n}\n\n// Add a localStorage entry with the key `debug` and value `SimpleFileUpload` to see debug messages\nconst debug = makeDebug('SimpleFileUpload')\n\nconst SimpleFileUpload = ({ apiKey, onSuccess, onDrop, width, height, preview, text, resizeWidth, resizeHeight, resizeMethod, tag, accepted, maxFileSize, multiple, maxFiles, removeLinks, buttonText, buttonClass }) => {\n  const sfu = useSimpleFileUpload()\n  const key = sfu.apiKey || apiKey\n  width = width || sfu.width\n  height = height || sfu.height\n  text = text || \"Drop file to upload\"\n  resizeMethod = resizeMethod || \"contain\"\n  buttonText = buttonText || \"Upload Files\"\n  maxFiles = maxFiles || 10\n\n  let small = \"false\"\n\n  if (parseInt(width) < 120) {\n    small = \"true\"\n  }\n\n  const [isMultipleUploader, setMultipleUploader] = useState(multiple)\n  const [isModalVisible, setModalVisible] = useState(false)\n  const [numberOfFiles, setNumberOfFiles] = useState(0)\n  const widgetId = useRef(shortid.generate())\n\n  useEffect(() => {\n    window.addEventListener('message', handleIframeMessage, false)\n    return () => {\n      window.removeEventListener('message', handleIframeMessage)\n    }\n  })\n  const handleIframeMessage = (e) => {\n    if (e.origin !== 'https://app.simplefileupload.com') {\n      return\n    }\n\n    if (e.data.widgetId !== widgetId.current) {\n      debug('Ignoring because widgetId does not match')\n      return\n    }\n\n    if (e.data.event == 'fileUploadSuccess') {\n      if(typeof onSuccess === 'function') {\n        // Single uploader - return URL only for backwards compatibility\n        if (!isMultipleUploader && e.data.files.length == 1) {\n          onSuccess(e.data.url)\n        } else {\n          onSuccess(e.data.files)\n        }\n      }\n\n      console.log(\"The uploaded files are listed as an Array of File Objects below\")\n      console.dir(e.data.files)\n\n      // Only call close iframe if the Add Files button was clicked. Explicitly sent via the \"close\" parameter \n      if(e.data.close === true) {\n        setModalVisible(false)\n        setNumberOfFiles(e.data.files.length)\n      }\n    }\n\n    if (e.data.event === 'closeWidget') {\n      // Only called when the X is clicked. Not called on \"Add\" button\n      setNumberOfFiles(e.data.numberOfFiles || 0)\n      setModalVisible(false)\n    }\n\n    if (e.data.event === 'dropStarted') {\n      if(typeof onDrop === 'function') {\n        onDrop(e.data.url);\n      }\n    }\n  }\n\n  const handleOpenClick = () => {\n    setModalVisible(true)\n  }\n\n  let modalStyle;\n\n  // Multiple Uploader has a different set of styles than Single Uploader\n  if (isMultipleUploader) {\n    if(isModalVisible) {\n      modalStyle = {\n        border: 'none',\n        display: 'block',\n        background: 'transparent',\n        position: 'fixed',\n        zIndex: 1000000,\n        top: 0,\n        left: 0\n      }\n    } else {\n      modalStyle = {\n        border: 0,\n        display: 'none'\n      }\n    }\n  // Single Uploader\n  } else {\n    display: 'block'\n  }\n\n  return (\n    <>\n      {multiple && (\n        <button onClick={handleOpenClick} className = {buttonClass}>\n          {numberOfFiles > 0 ? `${numberOfFiles} files uploaded` : buttonText}\n        </button>\n      )}\n\n      <iframe\n        title={`Simple File Upload ${widgetId.current}`}\n        src={`https://app.simplefileupload.com/buckets/${key}?widgetId=${widgetId.current}&preview=${preview}&text=${text}&small=${small}&resizeWidth=${resizeWidth}&resizeHeight=${resizeHeight}&resizeMethod=${resizeMethod}&tag=${tag}&accepted=${accepted}&maxFileSize=${maxFileSize}&multiple=${multiple}&maxFiles=${maxFiles}&removeLinks=${removeLinks}`}\n        className='widgetFrame'\n        width={isMultipleUploader ? '100%' : width}\n        height={isMultipleUploader ? '100%' : height}\n        style={modalStyle}\n        frameBorder=\"no\"\n      />\n    </>\n  );\n}\n\n\nexport default SimpleFileUpload\n"],"names":["SimpleFileUploadContext","createContext","apiKey","width","height","useSimpleFileUpload","useContext","SimpleFileUploadProvider","children","value","debug","makeDebug","SimpleFileUpload","onSuccess","onDrop","preview","text","resizeWidth","resizeHeight","resizeMethod","tag","accepted","maxFileSize","multiple","maxFiles","removeLinks","buttonText","buttonClass","sfu","key","small","parseInt","useState","isMultipleUploader","isModalVisible","setModalVisible","numberOfFiles","setNumberOfFiles","widgetId","useRef","shortid","generate","useEffect","window","addEventListener","handleIframeMessage","removeEventListener","e","origin","data","current","event","files","length","url","console","log","dir","close","handleOpenClick","modalStyle","border","display","background","position","zIndex","top","left"],"mappings":"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"}